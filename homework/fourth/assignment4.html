<!DOCTYPE html>
<html>
<head>
  <link href='http://fonts.googleapis.com/css?family=Nixie+One|Open+Sans:300italic,300,700|Pacifico' rel='stylesheet' type='text/css'>
	<meta charset="UTF-8">
  <title>Daniela Baron | Assignment 4 | Coursera WebGL</title>
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="../../css/reset.css">
  <link rel="stylesheet" href="../../css/styles.css">
  <link rel="stylesheet" href="../../css/assignment.css">

  <script id="vertex-shader-2" type="x-shader/x-vertex">

  // vertex data
  attribute vec4 vPosition;
  attribute vec3 vNormal;

  // camera settings
  uniform mat4 modelViewMatrix;
  uniform mat4 projectionMatrix;
  uniform mat3 normalMatrix;

  // lighting
  const int cNumLight = 2;
  uniform vec4 lightPosition[cNumLight];
  varying vec3 N, E;
  varying vec3 L[cNumLight];

  void main() {

    vec3 pos = (modelViewMatrix * vPosition).xyz;

    // lighting
    for (int i=0; i < cNumLight; i++) {
      if(lightPosition[i].w == 0.0)  L[i] = normalize(lightPosition[i].xyz);
      else  L[i] = normalize(lightPosition[i].xyz - pos);
    }

    E =  -normalize(pos);
    N = normalize( normalMatrix*vNormal.xyz);

    // apply matricies to the vertex
    gl_Position = projectionMatrix * modelViewMatrix * vPosition;
  }
  </script>

  <script id="fragment-shader-2" type="x-shader/x-fragment">
  precision mediump float;

  const int cNumLight = 2;
  uniform vec4 ambientProduct[cNumLight];
  uniform vec4 diffuseProduct[cNumLight];
  uniform vec4 specularProduct[cNumLight];
  uniform float shininess;
  uniform float attenuationA;
  uniform float attenuationB;

  varying vec3 N, E;
  varying vec3 L[cNumLight];

  void main() {
    vec4 fColor;
    vec3 H[cNumLight];
    vec4 ambient[cNumLight];
    float Kd[cNumLight];
    vec4 diffuse[cNumLight];
    float Ks[cNumLight];
    vec4 specular[cNumLight];

    for (int i=0; i < cNumLight; i++) {
      H[i] = normalize( L[i] + E );
      ambient[i] = ambientProduct[i];
      Kd[i] = max( dot(L[i], N), 0.0 );
      diffuse[i] = Kd[i] * diffuseProduct[i];
      Ks[i] = pow( max(dot(N, H[i]), 0.0), shininess );
      specular[i] = Ks[i] * specularProduct[i];
      if( dot(L[i], N) < 0.0 ) specular[i] = vec4(0.0, 0.0, 0.0, 1.0);
    }

    fColor = ambient[0] + attenuationA * (diffuse[0] + specular[0]) +
      ambient[1] + attenuationB * (diffuse[1] + specular[1]);
    fColor.a = 1.0;

    gl_FragColor = clamp(fColor, vec4(0,0,0,1), vec4(1,1,1,1));
  }
  </script>

  <script id="vertex-shader-1" type="x-shader/x-vertex">

  // vertex data
  attribute vec4 vPosition;
  attribute vec3 vNormal;

  // camera settings
  uniform mat4 modelViewMatrix;
  uniform mat4 projectionMatrix;

  // lighting
  uniform vec4 lightPosition;
  uniform mat3 normalMatrix;
  varying vec3 N, L, E;

  void main() {
    // lighting
    vec3 light;
    vec3 pos = (modelViewMatrix * vPosition).xyz;
    if(lightPosition.w == 0.0)  L = normalize(lightPosition.xyz);
    else  L = normalize(lightPosition.xyz - pos);
    E =  -normalize(pos);
    N = normalize( normalMatrix*vNormal.xyz);
    // apply matricies to the vertex
    gl_Position = projectionMatrix * modelViewMatrix * vPosition;
  }
  </script>

  <script id="fragment-shader-1" type="x-shader/x-fragment">
  precision mediump float;

  uniform vec4 ambientProduct;
  uniform vec4 diffuseProduct;
  uniform vec4 specularProduct;
  uniform float shininess;
  uniform float attenuation;

  varying vec3 N, L, E;

  void main() {
    vec4 fColor;
    vec3 H = normalize( L + E );
    vec4 ambient = ambientProduct;
    float Kd = max( dot(L, N), 0.0 );
    vec4  diffuse = Kd*diffuseProduct;
    float Ks = pow( max(dot(N, H), 0.0), shininess );
    vec4  specular = Ks * specularProduct;
    if( dot(L, N) < 0.0 ) specular = vec4(0.0, 0.0, 0.0, 1.0);

    fColor = ambient + attenuation * (diffuse + specular);
    fColor.a = 1.0;

    gl_FragColor = fColor;
  }
  </script>

  <!--  WebGL Utils -->
  <script type="text/javascript" src="../../Common/webgl-utils.js"></script>
  <script type="text/javascript" src="../../Common/initShaders.js"></script>
  <script type="text/javascript" src="../../Common/flatten.js"></script>
  <script type="text/javascript" src="../../Common/MV.js"></script>

  <!--  App Utils -->
  <script type="text/javascript" src="dom-utils.js"></script>
  <script type="text/javascript" src="color-utils.js"></script>
  <script type="text/javascript" src="coord-utils.js"></script>
  <script type="text/javascript" src="light.js"></script>

  <!-- Shapes -->
  <script type="text/javascript" src="shapes/shape-common.js"></script>
  <script type="text/javascript" src="shapes/tetrahedron.js"></script>
  <script type="text/javascript" src="shapes/sphere.js"></script>
  <script type="text/javascript" src="shapes/cylinder.js"></script>
  <script type="text/javascript" src="shapes/cone.js"></script>
  <script type="text/javascript" src="shapes/cube.js"></script>
  <script type="text/javascript" src="shape.js"></script>

  <!-- App -->
  <script type="text/javascript" src="assignment4.js"></script>
</head>

<body class="assignment">

  <!--[if lt IE 9]>
    <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
  <![endif]-->

  <nav>
		<a href="../../index.html#assignments">Assignments</a>
		<a href="../../index.html#experiments">Experiments</a>
		<a href="../../index.html">Home</a>
	</nav>

  <header>
    <h1>Assignment 4</h1>
    <h2>Lighting (work in progress)</h2>
  </header>

  <section class="settings side-controls">

    <div id="shapeSettings" class="">

      <!-- shape -->
      <div class="form-group">
        <label for="shape">Shape</label>
        <select name="shape" id="shape">
          <option selected> -- select a shape -- </option>
          <option value="Sphere">Sphere</option>
          <option value="Tetrahedron">Tetrahedron</option>
          <option value="Cube">Cube</option>
          <option value="Cylinder">Cylinder</option>
          <option value="Cone">Cone</option>
        </select>
      </div>

      <!--  color -->
      <div class="form-group">
        <label for="shapeColor" accesskey="c">Color</label>
        <input type="color" name="shapeColor" id="shapeColor" value="#ff0000">
      </div>

      <!--  rotate -->
      <div class="form-group">
        <label for="rotateX">Rotate X</label>
        <input type=range id=rotateX min=-180 value=45 max=180 step=15 oninput="outputRX(value)">
        <output for=rotateX id=rxv>45</output>
      </div>
      <div class="form-group">
        <label for="rotateY">Rotate Y</label>
        <input type=range id=rotateY min=-180 value=0 max=180 step=15 oninput="outputRY(value)">
        <output for=rotateY id=ryv>0</output>
      </div>
      <div class="form-group">
        <label for="rotateZ">Rotate Z</label>
        <input type=range id=rotateZ min=-180 value=0 max=180 step=15 oninput="outputRZ(value)">
        <output for=rotateZ id=rzv>0</output>
      </div>

      <!-- scale -->
      <div class="form-group">
        <label for="scaleX">Scale X</label>
        <input type=range id=scaleX min=0.1 value=0.2 max=5.0 step=0.1 oninput="outputSX(value)">
        <output for=scaleX id=sxv>0.2</output>
      </div>
      <div class="form-group">
        <label for="scaleY">Scale Y</label>
        <input type=range id=scaleY min=0.1 value=0.2 max=5.0 step=0.1 oninput="outputSY(value)">
        <output for=scaleY id=syv>0.2</output>
      </div>
      <div class="form-group">
        <label for="scaleZ">Scale Z</label>
        <input type=range id=scaleZ min=0.1 value=0.2 max=5.0 step=0.1 oninput="outputSZ(value)">
        <output for=scaleZ id=szv>0.2</output>
      </div>

      <!-- translate -->
      <div class="form-group">
        <label for="translateX">Translate X</label>
        <input type=range id=translateX min=-3.0 value=0 max=3.0 step=0.1 oninput="outputTX(value)">
        <output for=translateX id=txv>0</output>
      </div>
      <div class="form-group">
        <label for="translateY">Translate Y</label>
        <input type=range id=translateY min=-3.0 value=0 max=3.0 step=0.1 oninput="outputTY(value)">
        <output for=translateY id=tyv>0</output>
      </div>
      <div class="form-group">
        <label for="translateZ">Translate Z</label>
        <input type=range id=translateZ min=-3.0 value=1.0 max=3.0 step=0.1 oninput="outputTZ(value)">
        <output for=translateZ id=tzv>1.0</output>
      </div>

      <!--  material -->
      <div class="form-group">
        <label for="materialShininess">Shininess</label>
        <input type=range id=materialShininess min=1.0 value=10.0 max=50.0 step=1.0 oninput="outputMaterialShininess(value)">
        <output for=materialShininess id=mshiny>10.0</output>
      </div>

      <!--  actions -->
      <div class="form-group actions">
        <button id="newShape" title="create a new shape" class="button button-small"><i id="newShapeIcon" class="fa fa-plus icon"></i>Add</button>
        <button id="clear" class="button button-small"><i id="clearIcon" class="fa fa-refresh icon"></i>Reset</button>
        <button id="downloadShapeData" title="download shape data in JSON format" class="button button-small"><i id="downloadShapeDataIcon" class="fa fa-download icon"></i>JSON</button>
      </div>
    </div><!--//shape settings-->

    <div id="lightSettings1" class="light-settings">
      <div class="form-group">
        <input type="checkbox" id="lightSwitch" name="lightSwitch" value="lightSwitch" checked>
        <label for="lightSwitch">Light 1</label>
      </div>
      <div class="form-group">
        <label for="lightDiffuse">Light Diffuse</label>
        <input type="color" name="lightDiffuse" id="lightDiffuse" value="#ffffff">
        <label for="materialDiffuse">Material Diffuse</label>
        <input type="color" name="materialDiffuse" id="materialDiffuse" value="#ffffff">
      </div>
      <div class="form-group">
        <label for="lightSpecular">Light Specular</label>
        <input type="color" name="lightSpecular" id="lightSpecular" value="#ffffff">
        <label for="materialSpecular">Material Specular</label>
        <input type="color" name="materialSpecular" id="materialSpecular" value="#ffffff">
      </div>
      <div class="form-group">
        <label for="lightAmbient">Light Ambient</label>
        <input type="color" name="lightAmbient" id="lightAmbient" value="#ffffff">
      </div>
      <div class="form-group">
        <label for="lightDistance">Distance</label>
        <input type=range id=lightDistance min=0.0 value=0.0 max=3.0 step=0.1 oninput="outputLightDistance(value)">
        <output for=lightDistance id=ldz>0.0</output>
      </div>
    </div><!--//lightSettings1-->

    <div id="lightSettings2" class="light-settings">
      <div class="form-group">
        <input type="checkbox" id="lightSwitch2" name="lightSwitch2" value="lightSwitch2">
        <label for="lightSwitch">Light Source 2</label>
      </div>
      <div class="form-group">
        <label for="lightDiffuse">Light Diffuse</label>
        <input type="color" name="lightDiffuse" id="lightDiffuse2" value="#ffffff">
        <label for="materialDiffuse">Material Diffuse</label>
        <input type="color" name="materialDiffuse" id="materialDiffuse2" value="#ffdd05">
      </div>
      <div class="form-group">
        <label for="lightSpecular">Light Specular</label>
        <input type="color" name="lightSpecular2" id="lightSpecular2" value="#ffffff">
        <label for="materialSpecular2">Material Specular</label>
        <input type="color" name="materialSpecular2" id="materialSpecular2" value="#ffffff">
      </div>
      <div class="form-group">
        <label for="lightAmbient">Light Ambient</label>
        <input type="color" name="lightAmbient2" id="lightAmbient2" value="#333333">
      </div>
      <div class="form-group">
        <label for="lightDistance2">Distance</label>
        <input type=range id=lightDistance2 min=0.0 value=0.0 max=3.0 step=0.1 oninput="outputLightDistance2(value)">
        <output for=lightDistance2 id=ldz2>0.0</output>
      </div>
    </div><!--//lightSettings2-->

  </section><!--//side-controls-->

  <section class="drawing with-side-controls">

    <!-- Drawing area -->
    <div class="drawing-area">

      <canvas id="gl-canvas" width="800" height="700">
        Oops ... your browser doesn't support the HTML5 canvas element
      </canvas>

    </div>
  </section>


  <footer>
    <p>Daniela Baron <a href="https://www.coursera.org/course/webgl">Coursera WebGL</a></p>
  </footer>

  <script>
  var outputRX = function(value) {
    document.querySelector('#rxv').value = value;
  }
  var outputRY = function(value) {
    document.querySelector('#ryv').value = value;
  }
  var outputRZ = function(value) {
    document.querySelector('#rzv').value = value;
  }
  var outputSX = function(value) {
    document.querySelector('#sxv').value = value;
  }
  var outputSY = function(value) {
    document.querySelector('#syv').value = value;
  }
  var outputSZ = function(value) {
    document.querySelector('#szv').value = value;
  }
  var outputTX = function(value) {
    document.querySelector('#txv').value = value;
  }
  var outputTY = function(value) {
    document.querySelector('#tyv').value = value;
  }
  var outputTZ = function(value) {
    document.querySelector('#tzv').value = value;
  }
  var outputLightDistance = function(value) {
    document.querySelector('#ldz').value = value;
  }
  var outputLightDistance2 = function(value) {
    document.querySelector('#ldz2').value = value;
  }
  var outputMaterialShininess = function(value) {
    document.querySelector('#mshiny').value = value;
  }
  </script>

</body>
</html>
